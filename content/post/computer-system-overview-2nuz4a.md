<ul>
<li>
<p>第一章 计算机系统概述</p>
<ul>
<li>
<p>操作系统基本概念</p>
<ul>
<li>
<p>操作系统的概念</p>
</li>
<li>
<p>操作系统特征</p>
<ul>
<li>并发</li>
<li>共享</li>
<li>虚拟</li>
<li>异步</li>
</ul>
</li>
<li>
<p>操作系统的目标和功能</p>
</li>
</ul>
</li>
<li>
<p>操作系统发展历程</p>
<ul>
<li>手工操作</li>
<li>批处理</li>
<li>分时操作系统</li>
<li>实时操作系统</li>
<li>网络操作系统和分布式操作系统</li>
<li>个人计算机操作系统</li>
</ul>
</li>
<li>
<p>操作系统运行环境</p>
<ul>
<li>处理器运行模式</li>
<li>指令</li>
<li>内核的概念</li>
<li>中断和异常的概念</li>
<li>系统调用</li>
</ul>
</li>
<li>
<p>操作系统结构</p>
<ul>
<li>分层法</li>
<li>模块化</li>
<li>微内核</li>
<li>外核</li>
</ul>
</li>
<li>
<p>操作系统引导</p>
</li>
<li>
<p>虚拟机</p>
<ul>
<li>第一类虚拟机管理程序</li>
<li>第二类虚拟机管理程序</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>‍</p>
<h2>操作系统基本概念</h2>
<h3>操作系统的概念</h3>
<ul>
<li>最基本<u>系统软件</u></li>
<li>控制管理计算机系统的<u>软硬件资源</u></li>
<li>为用户和其他软件提供接口与环境的程序集合</li>
</ul>
<h3>操作系统特征</h3>
<ul>
<li><strong>并发和共享</strong> 是<u>最基本</u>的两个性质</li>
<li>并发和共享<u>互为存在条件</u></li>
<li>没有并发和共享就没有虚拟和异步</li>
</ul>
<ol>
<li>
<p><strong>并发</strong></p>
<p>两个或多个事件在<u>同一时间段</u>发生</p>
<p>利用I/O操作的间隔时间交替调度运行，保持cpu忙碌状态</p>
<blockquote>
<p>注意与并行的差异</p>
</blockquote>
</li>
<li>
<p><strong>共享</strong></p>
<p>系统中的资源可供内存中多个并发执行的进程<u>共同使用</u></p>
<ul>
<li><strong>互斥共享方式</strong></li>
</ul>
<p>A<u>用完</u>B才可用，如程序对摄像头权限的调用，打印机打印文件</p>
<ul>
<li><strong>同时共享方式</strong></li>
</ul>
<p>A<u>使用到一半时</u>暂停使用，此时B可使用</p>
</li>
<li>
<p><strong>虚拟</strong></p>
<p>将物理实体虚拟为多个逻辑上的虚拟物理实体</p>
<ul>
<li><strong>时分复用技术</strong></li>
</ul>
<p>如虚拟处理器，使得多个用户的任务能够在同一时段并发运行，每个用户都感觉存在专门的cpu为其服务</p>
<ul>
<li><strong>空分服用技术</strong></li>
</ul>
<p>利用存储器的空闲空间分区域存放和运行其他的多道程序，以此来提高内存的利用率</p>
</li>
<li>
<p><strong>异步</strong></p>
<p>一个任务启动后，程序可以继续执行其他任务，而<u>不需要等待该任务的结果</u></p>
<p>例如当客户端发送给服务端请求时，在等待服务端响应的过程中，客户端可以做其他事，节约时间，提高效率</p>
</li>
</ol>
<h3>操作系统的目标和功能</h3>
<h4>作为计算机系统资源的管理者</h4>
<ol>
<li>
<p><strong>处理机管理</strong></p>
<ul>
<li>
<p>处理机的分配和运行都以进程为基本单位，<u>处理机管理=进程管理</u></p>
</li>
<li>
<p>主要功能：进程控制+进程同步+进程通信+死锁处理+处理机调度</p>
</li>
</ul>
</li>
<li>
<p><strong>存储器管理</strong></p>
<ul>
<li>为了给多道程序的运行提供良好的环境，<u>方便用户使用及提高内存的利用率</u></li>
<li>主要功能：内存分配与回收+地址映射+内存保护+共享和内存扩充</li>
</ul>
</li>
<li>
<p><strong>文件管理</strong></p>
<ul>
<li>计算机的信息都是以文件的形式存在的</li>
<li>主要功能：文件存储空间的管理+目录管理+文件读写管理和保护</li>
</ul>
</li>
<li>
<p><strong>设备管理</strong></p>
<ul>
<li>完成用户的I/O请求，方便用户使用各种设备，提高设备利用率</li>
<li>主要功能：缓冲管理+设备分配+设备处理+虚拟设备</li>
</ul>
</li>
</ol>
<h4>作为用户和计算机硬件系统之间的接口</h4>
<ul>
<li>
<p><strong>命令接口（提供给用户）</strong></p>
</li>
<li>
<p><strong>联机命令接口</strong></p>
</li>
</ul>
<pre><code>又称&lt;u&gt;交互式控制接口&lt;/u&gt;，例如linux服务器的shell控制台
</code></pre>
<ul>
<li><strong>脱机命令接口</strong></li>
</ul>
<pre><code>又称&lt;u&gt;批处理命令接口&lt;/u&gt;，由一组作业控制命令组成，用户不能直接干预程序运行，只能使用作业控制命令&lt;u&gt;编写一组命令&lt;/u&gt;，提交给操作系统，操作系统再逐条执行
</code></pre>
<ul>
<li><strong>程序接口（提供给程序员）</strong></li>
</ul>
<p>由一组<u>系统调用</u>组成，用户通过程序中使用这些系统调用来请求操作系统为其提供服务，<u>系统调用是操作系统的一部分</u></p>
<p>另外，还有图形接口（GUI），图形接口通过点击直观的按钮来使用系统调用命令，图形接口不是操作系统的一部分，但其调用的命令是</p>
<h4>实现了对计算机资源的扩充</h4>
<ul>
<li>裸机：没有任何软件支持的计算机</li>
<li>扩充机器/虚拟机：覆盖了软件的机器</li>
</ul>
<h2>操作系统发展历程</h2>
<p>​<img src="https://image-host-pkj.oss-cn-guangzhou.aliyuncs.com/202404191045530.png" alt="" />​</p>
<h2>操作系统运行环境</h2>
<h3>处理器运行模式</h3>
<p>运行模式可以划分为<u>用户态（目态）</u>和<u>核心态（管态、内核态）</u></p>
<p>cpu的状态保存在cpu内部的一个寄存器中——程序状态字（PSW）寄存器，其中1表示内核态，0表示用户态</p>
<ul>
<li>
<p><strong>核心</strong> ​ <strong>态</strong></p>
</li>
<li>
<p>时钟管理相关指令</p>
</li>
<li>
<p>中断机制相关指令</p>
</li>
<li>
<p>原语相关指令</p>
</li>
<li>
<p>系统控制的数据结构与处理（进程调度程序、进程切换）</p>
</li>
<li>
<p><strong>用户态</strong></p>
</li>
<li>
<p>命令解释程序</p>
</li>
<li>
<p>系统调用</p>
</li>
<li>
<p>外部中断</p>
</li>
</ul>
<hr />
<p>如何变态：</p>
<ul>
<li>内核态——&gt;用户态，发生在中断返回用户程序时，使用修改PSW的特权命令</li>
<li>用户态——&gt;内核态，发生在中断时，通过硬件完成</li>
</ul>
<h3>指令</h3>
<p>指令是机器语言，是CPU能直接看懂并执行操作的</p>
<ul>
<li><strong>特权指令</strong></li>
</ul>
<p>不允许用户直接使用的指令，如：置/关中断、清内存、置时钟、访问程序状态、存取特殊寄存器、修改PSW寄存器</p>
<ul>
<li><strong>非特权指令</strong></li>
</ul>
<p>用户可以直接使用的指令，不能直接访问系统的软硬件资源，防止用户造成破坏</p>
<hr />
<p>cpu执行两种不同性质的程序：</p>
<ul>
<li><strong>操作系统内核程序</strong> （可以使用特权指令）</li>
<li><strong>用户自编程序</strong> （不能使用特权指令）</li>
</ul>
<p>前者是后者的管理者</p>
<h3>内核的概念</h3>
<p>操作系统包含了内核，内核是计算机上配置的<u>最底层软件</u>，是<u>连接应用程序和硬件</u>的桥梁，由两部分内容构成：</p>
<ul>
<li>与硬件关联紧密的模块（硬件抽象层）</li>
<li>运行频率较高的程序</li>
</ul>
<p>大多数操作系统的内核包含四个内容：</p>
<ul>
<li>
<p><strong>时钟管理</strong></p>
</li>
<li>
<p>向用户提供标准系统时间</p>
</li>
<li>
<p>分时操作系统的时间片轮转调度</p>
</li>
<li>
<p>实时操作系统的按截止时间控制运行</p>
</li>
<li>
<p>批处理系统衡量作业的运行程度</p>
</li>
<li>
<p><strong>中断机制</strong></p>
</li>
</ul>
<p>中断机制中只有一小部分属于内核</p>
<p>保护和回复中断现场的信息，转移控制权到中断处理程序</p>
<ul>
<li>
<p><strong>原语</strong></p>
</li>
<li>
<p>处于操作系统底层，最接近硬件</p>
</li>
<li>
<p>操作只能一气呵成不能中断</p>
</li>
<li>
<p>运行时间短且调用频繁</p>
</li>
<li>
<p><strong>系统控制的数据结构及处理</strong></p>
</li>
<li>
<p>进程管理</p>
</li>
<li>
<p>存储器管理</p>
</li>
<li>
<p>设备管理</p>
</li>
</ul>
<h3>中断和异常的概念</h3>
<p>​<img src="https://image-host-pkj.oss-cn-guangzhou.aliyuncs.com/202404212125481.png" alt="" />​</p>
<ul>
<li><strong>中断（外中断）</strong></li>
</ul>
<p>由CPU<u>外部设备发出的请求</u>，是与<u>当前正在执行的指令无关</u>的<u>异步事件</u>，也<u>不阻止任何指令完成</u></p>
<p>执行时间：CPU每<u>执行完一条指令</u>即检查中断请求信号线，检测到则进入中断响应期</p>
<ul>
<li><strong>可屏蔽中断</strong></li>
</ul>
<pre><code>INTR线发出的，CPU可以根据其优先级接受或忽略的中断，如打印机中断
</code></pre>
<ul>
<li><strong>不可屏蔽中断</strong></li>
</ul>
<pre><code>通过NMI线发出的，紧急硬件故障，如电源掉电
</code></pre>
<ul>
<li><strong>异常（内中断）</strong></li>
</ul>
<p>CPU执行指令时，<u>CPU自身检测到</u>的与正在执行的指令相关的<u>同步事件</u>，<u>不可屏蔽</u></p>
<p>执行时间：<u>执行指令时</u>检查</p>
<ul>
<li><strong>故障</strong></li>
</ul>
<pre><code>&lt;u&gt;指令启动后，结束前&lt;/u&gt;检测到的异常事件，通常可以被故障处理程序修正

非法操作码、缺页故障、除数为0、运算溢出
</code></pre>
<ul>
<li><strong>自陷（陷阱、陷入）</strong></li>
</ul>
<pre><code>预先安排的“异常事件”，用于在用户态调用操作系统内核程序，例如系统调用
</code></pre>
<ul>
<li><strong>终止</strong></li>
</ul>
<pre><code>出现使CPU无法继续执行的硬件故障
</code></pre>
<h3>系统调用</h3>
<ul>
<li>
<p><strong>定义</strong></p>
</li>
<li>
<p>操作系统给应用程序和程序员提供的用于请求系统服务的接口</p>
</li>
<li>
<p>使用系统调用需要触发自陷（trap/访管指令）</p>
</li>
<li>
<p>操作系统通过提供系统调用<u>避免用户直接访问硬件</u></p>
</li>
<li>
<p><strong>按功能分类</strong></p>
</li>
<li>
<p><strong>设备管理</strong></p>
</li>
</ul>
<pre><code>设备的请求或释放，设备启动
</code></pre>
<ul>
<li><strong>文件管理</strong></li>
</ul>
<pre><code>文件读写创建删除
</code></pre>
<ul>
<li><strong>进程控制</strong></li>
</ul>
<pre><code>进程创建、撤销、阻塞、唤醒
</code></pre>
<ul>
<li><strong>进程通信</strong></li>
</ul>
<pre><code>进程之间信息传递或信号传递
</code></pre>
<ul>
<li><strong>内存管理</strong></li>
</ul>
<pre><code>内存的分配、回收、获取作业占用内存大小及起始地址
</code></pre>
<ul>
<li><strong>调用过程</strong></li>
</ul>
<ol>
<li>传参</li>
<li>自陷（执行系统调用），发生于用户态</li>
<li>操作系统内核处理系统调用请求，发生于内核态</li>
<li>返回应用</li>
</ol>
<p>​<img src="https://image-host-pkj.oss-cn-guangzhou.aliyuncs.com/202404221957718.png" alt="" />​</p>
<h2>操作系统结构</h2>
<h3>分层法</h3>
<p>将操作系统分层，最底层为硬件，最顶层为用户接口，每层只能调用低一层的服务和功能（单向依赖）</p>
<ul>
<li><strong>优点</strong></li>
</ul>
<ol>
<li>便于系统调试和验证——单向依赖</li>
<li>易于扩充和维护，不改变各层之间的接口则不会影响其它层</li>
</ol>
<ul>
<li><strong>缺点</strong></li>
</ul>
<ol>
<li>难以合理定义各层，固定依赖关系后不够灵活</li>
<li>效率较差，执行一个功能需要跨越多层，增加开销</li>
</ol>
<p>​<img src="https://image-host-pkj.oss-cn-guangzhou.aliyuncs.com/202404222007080.png" alt="" />​</p>
<h3>模块化</h3>
<p>将操作系统按照功能划分为具有一定独立性的模块，并规定好各个模块之间的接口，还可以将模块再划分为子模块（模块——接口法）</p>
<p>模块独立性的衡量有两个标准：</p>
<ul>
<li><strong>内聚性</strong> ：<u>模块内</u>各部分联系的紧密程度，<u>越高独立性越好</u></li>
<li><strong>耦合度</strong> ：<u>模块间</u>相互联系影响程度，<u>越低独立性越好</u></li>
</ul>
<p>​<img src="https://image-host-pkj.oss-cn-guangzhou.aliyuncs.com/202404222014202.png" alt="" />​</p>
<ul>
<li><strong>优点</strong></li>
</ul>
<ol>
<li>提高操作系统设计的正确性，可理解性和可维护性</li>
<li>增强操作系统的可适应性</li>
<li>加速操作系统开发过程</li>
</ol>
<ul>
<li><strong>缺点</strong></li>
</ul>
<ol>
<li>模块之间的接口规定难以满足实际需求</li>
<li>各模块同步开发难以确定统一基础，无法找到可靠决定顺序</li>
</ol>
<h3>宏内核</h3>
<p>也称单内核或大内核。将系统的主要功能模块都<u>作为一个紧密整体运行在核心态</u>，各管理模块<u>共享信息</u>，具有性能优势</p>
<h3>⭐微内核</h3>
<ul>
<li><strong>定义</strong></li>
</ul>
<p>只把<u>核心功能放入内核</u>，其余功能以<u>用户进程</u>的形式运行在用户态，借助微内核进行通信，即采用<u>客户/服务器模式</u></p>
<ol>
<li>与硬件处理联系紧密的部分</li>
<li>一组关键原语，仅包括建立一个系统必需的几个部分</li>
<li>客户与服务器之间的通信</li>
</ol>
<p>​<img src="https://image-host-pkj.oss-cn-guangzhou.aliyuncs.com/202404222029988.png" alt="" />​</p>
<ul>
<li><strong>基本功能</strong></li>
</ul>
<p>微内核结构利用“ <strong><u>机制/策略分离</u></strong> ”原理，机制和与硬件紧密的部分放入内核</p>
<ul>
<li><strong>进程管理</strong></li>
</ul>
<pre><code>* 进程通信
* 进程切换
* 进程调度
* 多处理机同步

其余内容如用户进程分类、优先级确认方式等都属于策略
</code></pre>
<ul>
<li><strong>低级存储器管理</strong></li>
</ul>
<pre><code>如逻辑地址转换为物理地址，页表机制，地址变换机制，依赖硬件因此属于微内核

实现虚拟存储器管理、应使用的页面置换算法、内存分配与回收的策略应放于内核外
</code></pre>
<ul>
<li><strong>中断和自陷处理</strong></li>
</ul>
<pre><code>捕获中断和自陷，并进行中断响应处理，识别后发送给对应服务器处理
</code></pre>
<ul>
<li><strong>特点</strong></li>
</ul>
<ol>
<li>
<p><strong>扩展性和灵活性</strong></p>
<p>增改功能只需要增改相应服务器，无需改动内核</p>
</li>
<li>
<p><strong>可靠性和安全性</strong></p>
<p>只有微内核处于内核态，处于用户态的模块错误只会导致模块崩溃，而不会使得内核崩溃</p>
</li>
<li>
<p><strong>可移植性</strong></p>
<p>移植平台时只需要改动与CPU和I/O硬件有关的微内核代码，其余服务器代码与硬件平台无关</p>
</li>
<li>
<p><strong>分布式计算</strong></p>
<p>采用客户/服务器模式，可以很好支持分布式系统和网络系统</p>
</li>
</ol>
<p>由于微内核的<u>高度可靠性</u>，常用于<u> <strong>实时、工业、航空、军事领域</strong> </u></p>
<ul>
<li><strong>问题</strong></li>
</ul>
<p>主要为性能问题，需要频繁进行内核态与用户态的切换</p>
<h3>外核</h3>
<p>内核态程序，为虚拟机分配资源以及检查并确保虚拟机资源不发生冲突</p>
<p>减少了资源的映射层，资源的管理由外核处理，外核记录已分配的各个虚拟机资源</p>
<p>将外核内的多道程序与用户操作系统代码分离</p>
<h2>操作系统引导</h2>
<p>操作系统引导是指计算机利用 CPU 运行特定程序，通过程序识别硬盘，识别硬<a href="">盘</a>分区，识别硬盘分区上的操作系统，最后通过程序启动操作系统，一环扣一环地完成上述过程</p>
<ul>
<li><strong>引导过程</strong></li>
</ul>
<ol>
<li>
<p><strong>激活CPU</strong></p>
<ul>
<li>读取boot程序，开始执行BIOS指令</li>
</ul>
</li>
<li>
<p><strong>硬件自检</strong></p>
<ol>
<li>BIOS构建<u>中断向量表</u></li>
<li>通电自检</li>
</ol>
</li>
<li>
<p><strong>加载带操作系统硬盘</strong></p>
<ol>
<li>BIOS读取硬盘启动顺序，或与用户交互</li>
<li>CPU将该存储设备<u>引导扇区</u>加载到 <strong><u>内存</u></strong></li>
</ol>
</li>
<li>
<p><strong>加载引导扇区中的</strong> ​<u> <strong>MBR主引导记录</strong> </u></p>
<ul>
<li>MBR记录了硬盘分区表和磁盘引导程序</li>
</ul>
</li>
<li>
<p><strong>扫描硬盘分区表，加载活动分区（C盘）</strong></p>
</li>
<li>
<p><strong>加载PBR分区引导记录</strong></p>
<ul>
<li>将活动分区的第一个扇区<u>PBR加载到</u>​<u> <strong>内存</strong> </u></li>
<li>寻找活动分区根目录下的启动管理器</li>
</ul>
</li>
<li>
<p><strong>加载启动管理器</strong></p>
</li>
<li>
<p><strong>加载操作系统</strong></p>
<ul>
<li>将<u>操作系统初始化程序</u>加载到 <strong><u>内存</u></strong> 中执行</li>
</ul>
</li>
</ol>
<p>​<img src="https://image-host-pkj.oss-cn-guangzhou.aliyuncs.com/202404222143908.png" alt="" />​</p>
<h2>虚拟机</h2>
<p>利用虚拟化技术将一台物理机虚拟化为多台虚拟机</p>
<table>
<thead>
<tr>
<th></th>
<th>第一类虚拟机管理程序</th>
<th>第二类虚拟机管理程序</th>
</tr>
</thead>
<tbody>
<tr>
<td>物理资源控制权</td>
<td>直接控制和分配物理资源</td>
<td>依赖宿主OS分配资源</td>
</tr>
<tr>
<td>资源分配方式</td>
<td>安装客户OS时，需要自行分配物理存储空间，使用类似外核的方式分配物理硬件</td>
<td>由一个宿主OS的文件作为虚拟磁盘</td>
</tr>
<tr>
<td>虚拟机性能</td>
<td>好</td>
<td>差，需要宿主OS作为中介</td>
</tr>
<tr>
<td>支持虚拟机数量</td>
<td>更多，不与宿主OS争夺资源</td>
<td>更少，宿主OS本身运行需要占用资源</td>
</tr>
<tr>
<td>虚拟机迁移性</td>
<td>差</td>
<td>好，只需要导出虚拟机镜像文件即可</td>
</tr>
<tr>
<td>运行模式</td>
<td>运行在<u>最高特权级</u>，可以执行最高特权指令</td>
<td>部分运行在<u>用户态</u>，部分运行在内核态<br />客户OS的系统调用会被截获转换为宿主OS的系统调用<br /></td>
</tr>
</tbody>
</table>
<p>​<img src="https://image-host-pkj.oss-cn-guangzhou.aliyuncs.com/202404222200076.png" alt="" />​</p>
